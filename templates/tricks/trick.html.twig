{% extends 'base.html.twig' %}

{% block body %}
    <section id="backgroundTrick">
        <div class="container" id="trickDisplay">
            <div>
                <img id="featuredImg" alt="Image Trick">
                <div id="trickSpecificName">
                    <h1>{{ trick.name }}</h1>
                </div>
                <div id="trickSpecifiedButtons">
                    <a href="{{ path('edit_trick', {id: trick.id}) }}"><i class="fa-solid fa-pen"></i></a>
                    <a href="{{ path('delete_trick', {id: trick.id}) }}"><i class="fa-solid fa-trash"></i></a>
                </div>
            </div>
            
            <div class="container" id="trickInfo">
                {% include 'parts/carousel/_carousel.html.twig' %}
                <p>
                    {{ trick.description }}
                    <small class="text-muted">{{ trick.updatedAt | date("d/m/Y H:i") }}</small>
                </p>
                <div id="trickInfoDetails">
                    <small>{{ trick.category }}</small>
                </div>
                <form method="post">
                    <div class="row" id="trickInfoLeavingComment">
                        <div class="col-lg col-xs" id="trickTextarea">
                            <textarea placeholder="Enter your message"></textarea>
                            <button type="button" class="btn btn-secondary">Leave a comment</button>
                        </div>
                    </div>
                </form> 
                <div class="row" id="trickCommentList">
                    {# <img src="https://www.w3schools.com/w3images/avatar5.png">
                    <div class="card">
                        <div class="card-header">Pseudonyme</div>
                        <p class="card-text">
                            Some quick example text to build on the card title and make up the bulk of the card's content.
                            <small class="text-muted">12/10/2020 Ã  14h58</small>
                        </p>
                    </div> #}
                    {% include 'parts/_comments.html.twig' with {'comment': comment} %}
                </div>
                <div id="trickItemsLoad">
                    <button type="button" class="btn btn-secondary" id="load-more-comments" data-url="{{ path('load-more-comments', {'id': trick.id}) }}" data-nextpage="2">Load more</button>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    <script>
        const containerTricks = document.querySelector('#trickCommentList');
        const buttonElement = document.querySelector('#load-more-comments');

        buttonElement.addEventListener('click', (e) => {
            const urlToCall = buttonElement.dataset.url;
            const nextPage = buttonElement.dataset.nextpage;
            fetch(`${urlToCall}?page=${nextPage}`)
            .then(resp => resp.json())
            .then(data => {
                if (data.code === 200) {
                    containerTricks.innerHTML += data.html;
                    buttonElement.dataset.nextpage++;
                }
            })
        })
    </script>
{% endblock %}