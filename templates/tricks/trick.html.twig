{% extends 'base.html.twig' %}

{% block body %}
    <section id="backgroundTrick">
        <div class="container" id="trickDisplay">
            <div>
                <img id="featuredImg" alt="Image Trick">
                <div id="trickSpecificName">
                    <h1>{{ trick.name }}</h1>
                </div>
                <div id="trickSpecifiedButtons">
                    <a href="{{ path('edit_trick', {id: trick.id}) }}"><i class="fa-solid fa-pen"></i></a>
                    <a href="#"><i class="fa-solid fa-trash"></i></a>
                </div>
            </div>
            
            <div class="container" id="trickInfo">
                {% include 'parts/carousel/_carousel.html.twig' %}
                <p>
                    {{ trick.description }}
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                    Sed et nisi vel justo vulputate auctor. In varius enim sed lorem dapibus elementum. Suspendisse aliquam hendrerit diam in viverra. 
                    Suspendisse potenti. Vivamus interdum ligula et lacinia dapibus. Curabitur at felis ac mi ultrices iaculis vel et purus. 
                    Nullam et est et nisl finibus bibendum ut sed nunc. Curabitur hendrerit sed urna vitae finibus. 
                    Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nulla faucibus tempus porta. 
                    Nulla ut mauris a purus placerat placerat tristique eget ante.
                    Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; 
                    Vestibulum imperdiet viverra vestibulum. Cras volutpat elementum metus, vel eleifend mauris sagittis a. 
                    Cras urna ante, bibendum vel eleifend vel, cursus vitae enim. Sed lacus nibh, maximus non elementum a, suscipit ac felis. 
                    Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aliquam mattis nibh placerat, porttitor est et, sodales turpis. 
                    Duis vitae metus non metus dapibus lobortis at vel mauris. Ut eleifend dolor non sapien dictum fringilla id non nulla. Vivamus et rhoncus dui. 
                    Maecenas vulputate augue sed sollicitudin laoreet. Aliquam consequat sodales augue, non fringilla eros porttitor vitae. 
                    Suspendisse facilisis, urna venenatis viverra gravida, felis magna ultrices tellus, at condimentum odio urna eget risus. 
                    Suspendisse quis luctus ipsum. Morbi convallis massa eu urna efficitur, eget vestibulum tortor tempor. 
                    Suspendisse lorem nulla, euismod ac dui ac, egestas cursus ipsum.
                    <small class="text-muted">{{ trick.updatedAt | date("d/m/Y H:i") }}</small>
                </p>
                <div id="trickInfoDetails">
                    <small>{{ trick.category }}</small>
                </div>
                <form method="post">
                    <div class="row" id="trickInfoLeavingComment">
                        <div class="col-lg col-xs" id="trickTextarea">
                            <textarea placeholder="Enter your message"></textarea>
                            <button type="button" class="btn btn-secondary">Leave a comment</button>
                        </div>
                    </div>
                </form> 
                <div class="row" id="trickCommentList">
                    {# <img src="https://www.w3schools.com/w3images/avatar5.png">
                    <div class="card">
                        <div class="card-header">Pseudonyme</div>
                        <p class="card-text">
                            Some quick example text to build on the card title and make up the bulk of the card's content.
                            <small class="text-muted">12/10/2020 Ã  14h58</small>
                        </p>
                    </div> #}
                    {% include 'parts/_comments.html.twig' with {'comment': comment} %}
                </div>
                <div id="trickItemsLoad">
                    <button type="button" class="btn btn-secondary" id="load-more-comments" data-url="{{ path('load-more-comments', {'id': trick.id}) }}" data-nextpage="2">Load more</button>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    <script>
        const containerTricks = document.querySelector('#trickCommentList');
        const buttonElement = document.querySelector('#load-more-comments');

        buttonElement.addEventListener('click', (e) => {
            const urlToCall = buttonElement.dataset.url;
            const nextPage = buttonElement.dataset.nextpage;
            fetch(`${urlToCall}?page=${nextPage}`)
            .then(resp => resp.json())
            .then(data => {
                if (data.code === 200) {
                    containerTricks.innerHTML += data.html;
                    buttonElement.dataset.nextpage++;
                }
            })
        })
    </script>
{% endblock %}